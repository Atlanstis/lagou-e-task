## 简答题

#### 谈谈你是如何理解 JS 异步编程的，EventLoop、消息队列都是做什么的，什么是宏任务，什么是微任务？

**答:**

JavaScript 代码在浏览器环境中，是以一种非阻塞，单线程的方式执行的，这表示在同一时刻只有一个代码段在执行。为了协调事件、用户交互、脚本、UI 渲染和网络处理等行为，JavaScript 采用 EventLoop（事件循环）来防止主线程的不阻塞。

JavaScript 代码的执行过程中，除了依靠函数调用栈来搞定函数的执行顺序外，还依靠任务队列（task queue）来搞定另外一些代码的执行。整个执行过程，我们称为事件循环过程。一个线程中，事件循环是唯一的，但是任务队列可以拥有多个。任务队列又分为宏任务（macro-task）与微任务（micro-task）。

常见的宏任务有：

- script(整体代码)
- setTimeout
- setInterval

常见的微任务有：

- Promise.then()
- MutationObserver
- queueMicrotask
- process.nextTick（node.js）

当 JavaScript 代码第一次执行的时候，JavaScript 引擎会解析这段代码，并将其中的同步代码按照执行顺序加入执行栈中，然后从头开始执行。如果当前执行的是一个方法，那么js会向执行栈中添加这个方法的执行环境，然后进入这个执行环境继续执行其中的代码。当这个执行环境中的代码，执行完毕并返回结果后，JavaScript 会退出这个执行环境并把这个执行环境销毁，回到上一个方法的执行环境。这个过程反复进行，直到执行栈中的代码全部执行完毕。

当遇到异步事件时，JavaScript 引擎并不会一直等待其返回结果，而是会将这个事件挂起，继续执行执行栈中的其他任务。当一个异步事件返回结果后，JavaScript 会将这个事件加入与当前执行栈不同的另一个队列，我们称之为任务队列。

根据这个异步事件的类型，这个事件会被加入到对应的宏任务队列或者微任务队列中去。并且在当前执行栈为空的时候，主线程会查看微任务队列是否有事件存在。如果不存在，那么再去宏任务队列中取出一个事件并把对应的回到加入当前执行栈；如果存在，则会依次执行队列中事件对应的回调，直到微任务队列为空，然后去宏任务队列中取出最前面的一个事件，把对应的回调加入当前执行栈。如此反复，进入循环。

